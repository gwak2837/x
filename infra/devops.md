## DevOps

### 1. 브랜치 전략

트렁크 기반 개발 전략을 유지하면서 release 브랜치를 도입하여 안정적인 배포 프로세스를 구현합니다.

- **Main 브랜치**: 항상 안정적인 코드를 유지하고, 프로덕션에 배포 가능한 상태여야 합니다.
- **Feature 브랜치**: 새로운 기능을 개발할 때 main 브랜치를 기반으로 생성하며, 기능 개발이 완료되면 main 브랜치에 병합합니다. 예: `feature/...`
- **Release 브랜치**: 특정 릴리스 버전을 준비하기 위해 main 브랜치에서 분기합니다. 예: `release/{version}`
- **Fix 브랜치**: 프로덕션에서 발견된 버그를 긴급히 수정할 때 사용하며, 수정이 완료되면 main 브랜치 또는 release 브랜치에 병합합니다.

### 2. 배포 환경

#### 로컬 환경 (local)

- **목적**: 개발자들이 자신의 로컬 머신에서 작업하고 테스트할 수 있는 환경
- **규칙**:
  - 각 개발자는 feature 브랜치를 생성하여 로컬 환경에서 개발을 진행
  - 로컬 환경에서 충분히 테스트하고, 문제가 없다고 판단되면 원격 저장소에 푸시하여 PR을 생성
  - `feature/**` 브랜치에 새로운 커밋이 발생하면 자동으로 빌드 후 레지스트리에 업로드 (수동 배포)
  - main 브랜치 병합 후 feature 브랜치 관련 이미지 삭제

#### 개발 환경 (dev)

- **목적**: 개발자들이 자유롭게 작업하고 테스트할 수 있는 환경
- **규칙**:
  - main 브랜치에 새로운 커밋이 발생하면 자동으로 빌드 후 test 환경에 배포

#### 테스트 환경 (test)

- **목적**: QA 팀 또는 프론트엔드/백엔드 팀이 기능을 테스트하는 환경
- **규칙**:
  - main 브랜치에 새로운 커밋이 발생하면 자동으로 빌드 후 test 환경에 배포

#### 스테이징 환경 (stage)

- **목적**: 프로덕션과 동일한 환경에서 최종 검증을 하는 환경
- **규칙**:
  - QA 팀이 main 브랜치 기반으로 `release/{version}` 브랜치를 생성
  - release 브랜치에 새로운 커밋이 발생하면 자동으로 빌드 후 stage 환경에 배포
  - 검증 완료 후, release 브랜치에서 필요한 수정이 발생하면 해당 브랜치에 커밋하고 다시 배포

#### 프로덕션 환경 (prod)

- **목적**: 실제 사용자에게 서비스를 제공하는 환경
- **규칙**:
  - QA가 완료된 `release/{version}` 브랜치의 HEAD를 prod 환경에 배포
  - 배포 후 문제가 발생하면, 이전 버전의 release 브랜치 이미지로 원클릭 롤백

### 3. 데이터베이스 전략

#### 실제 사용자 데이터베이스

- 대상 환경: stage, prod
- 특징: 실제 사용자 데이터를 포함하며, 민감한 정보를 포함할 수 있습니다. 이 데이터베이스는 실제 운영 데이터로 구성되어 있어, 현실적인 테스트를 수행할 수 있습니다.

#### 더미 데이터베이스

- 대상 환경: local, test, dev
- 특징: 개발과 초기 테스트를 위한 더미 데이터를 포함합니다. 이 데이터베이스는 자주 초기화되거나 변경될 수 있으며, 민감한 정보는 포함하지 않습니다.

### 4. CI/CD 파이프라인 구성

#### CI (Continuous Integration)

- 모든 PR은 자동으로 도커 이미지 빌드 및 테스트 실행
- `main` 브랜치에 대해선 적절한 테스트 및 승인 권장
- `release/{version}` 브랜치에 대해선 모든 테스트 및 승인 필수

#### CD (Continuous Deployments)

- `main` 브랜치로 병합 시, dev 및 test 환경으로 자동 배포
- `release/{version}` 브랜치 생성 시, stage 환경으로 자동 배포
- QA 이후 `release/{version}` 브랜치의 HEAD를 prod 환경으로 수동 배포
- stage 환경과 prod 환경에 대한 자동 배포 트리거 설정.
- test 환경에서 오류 발생 시, Argo CD/Rollouts 원클릭 롤백 기능 구현

### 5. 롤백 전략

#### Prod 환경에서의 롤백

- 배포 후 모니터링을 통해 문제를 감지하고, 문제 발생 시 이전 안정적인 커밋으로 롤백
- 롤백 과정도 원클릭으로 이뤄질 수 있게 해서 신속하게 문제를 해결
